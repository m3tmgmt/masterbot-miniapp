import{u as I,a as A,b as P,r as l,j as t,T as R,V as B,Z as z,P as L}from"./index-BMpdN1di.js";import{B as O,a as _}from"./BodyModel3D-BbV12HDE.js";function F(c="light"){try{window.Telegram?.WebApp?.HapticFeedback?.impactOccurred(c)}catch{}}const V=(()=>{try{const c=document.createElement("canvas");return!!(c.getContext("webgl2")||c.getContext("webgl"))}catch{return!1}})(),W=[{value:"front",label:"Ð¡Ð¿ÐµÑ€ÐµÐ´Ð¸"},{value:"back",label:"Ð¡Ð·Ð°Ð´Ð¸"},{value:"free",label:"Ð¡Ð²Ð¾Ð±Ð¾Ð´Ð½Ð¾"}];function U(){const{userName:c}=I(),p=A(),g=P(),[s,d]=l.useState([]),[n,r]=l.useState(null),[x,m]=l.useState(new Map),[h,y]=l.useState("front"),[i,u]=l.useState("prompt"),[f,C]=l.useState(null),k=new Map(s.map(e=>[e.zoneId,e.intensity])),j=l.useCallback(e=>{if(F("light"),s.find(o=>o.zoneId===e))r(e);else{const o=O.get(e);if(!o)return;const T={zoneId:o.zoneId,nameRu:o.nameRu,anatomicalName:o.anatomicalName,touchPoint:{x:o.position[0],y:o.position[1]},intensity:5};d(E=>[...E,T]),r(e)}},[s]),S=l.useCallback(e=>{n&&(d(a=>a.map(o=>o.zoneId===n?{...o,intensity:e.intensity,painType:e.painType}:o)),m(a=>{const o=new Map(a);return o.set(n,{painType:e.painType,duration:e.duration,description:e.description}),o}),r(null))},[n]),N=l.useCallback(()=>{n&&(d(e=>e.filter(a=>a.zoneId!==n)),m(e=>{const a=new Map(e);return a.delete(n),a}),r(null))},[n]),Z=l.useCallback(e=>{d(a=>a.filter(o=>o.zoneId!==e)),m(a=>{const o=new Map(a);return o.delete(e),o}),n===e&&r(null)},[n]),D=l.useCallback(e=>{C(e),u("done")},[]),w=l.useCallback(()=>{u("skipped")},[]),M=()=>{p("/intake",{state:{bodyMapZones:s,zoneDetails:Object.fromEntries(x),bodyScanId:f?.id??null}})};if(!V)return t.jsx(R,{icon:"ðŸŒ",title:"3D Ð½Ðµ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ÑÑ",description:"Ð’Ð°Ñˆ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€ Ð½Ðµ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ WebGL. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ 2D ÐºÐ°Ñ€Ñ‚Ñƒ Ñ‚ÐµÐ»Ð°.",actionLabel:"ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ 2D ÐºÐ°Ñ€Ñ‚Ñƒ",onAction:()=>p("/intake")});const v=s.find(e=>e.zoneId===n),b=n?x.get(n):void 0;return t.jsxs("div",{className:"pb-20",children:[t.jsxs("div",{className:"p-4 pb-2",children:[t.jsx("h1",{className:"text-xl font-bold mb-1",children:"3D ÐšÐ°Ñ€Ñ‚Ð° Ð±Ð¾Ð»Ð¸"}),t.jsxs("p",{className:"text-sm",style:{color:"var(--plm-text-hint)"},children:["ÐœÐ°ÑÑ‚ÐµÑ€: ",c]})]}),i==="prompt"&&t.jsx("div",{className:"px-4 pb-4",children:t.jsx(B,{onComplete:D,onFallback:w})}),i!=="prompt"&&t.jsx("div",{className:"px-4 pb-3",children:t.jsxs("div",{className:"py-2 px-3 rounded-lg text-sm border",style:i==="done"?{backgroundColor:"var(--plm-health-good-bg)",color:"var(--plm-health-good)",borderColor:"var(--plm-health-good-border)"}:{backgroundColor:"var(--plm-bg-secondary)",color:"var(--plm-text-hint)",borderColor:"var(--plm-border)"},children:[i==="done"?"Ð’Ð¸Ð´ÐµÐ¾ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð¾":"Ð‘Ð°Ð·Ð¾Ð²Ð°Ñ Ð¼Ð¾Ð´ÐµÐ»ÑŒ. Ð¡Ð½Ð¸Ð¼Ð¸Ñ‚Ðµ Ð²Ð¸Ð´ÐµÐ¾ Ð´Ð»Ñ Ð¿ÐµÑ€ÑÐ¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸",i==="skipped"&&t.jsx("button",{type:"button",className:"ml-2 underline text-xs",style:{color:"var(--plm-text-link)"},onClick:()=>u("prompt"),children:"Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð²Ð¸Ð´ÐµÐ¾"})]})}),t.jsx("div",{className:"px-4 pb-3",children:t.jsx("div",{className:"flex gap-1 rounded-lg p-1",style:{backgroundColor:"var(--plm-bg-secondary)"},children:W.map(e=>t.jsx("button",{type:"button",className:"flex-1 py-2.5 rounded-md text-sm font-medium transition-colors",style:h===e.value?{backgroundColor:"var(--plm-btn-bg)",color:"var(--plm-text)"}:{color:"var(--plm-text-hint)"},onClick:()=>y(e.value),children:e.label},e.value))})}),t.jsx("div",{className:"mx-4 rounded-xl overflow-hidden border",style:{height:"55vh",borderColor:"var(--plm-border)",backgroundColor:"var(--plm-bg)"},children:t.jsx(_,{selectedZones:k,onZoneClick:j,activeZoneId:n??void 0,cameraPreset:h})}),t.jsx("p",{className:"text-xs text-center mt-2 px-4",style:{color:"var(--plm-text-hint)"},children:"ÐÐ°Ð¶Ð¸Ð¼Ð°Ð¹Ñ‚Ðµ Ð½Ð° Ð·Ð¾Ð½Ñ‹ Ñ‚ÐµÐ»Ð° Ð´Ð»Ñ Ð¾Ñ‚Ð¼ÐµÑ‚ÐºÐ¸ Ð±Ð¾Ð»Ð¸. Ð’Ñ€Ð°Ñ‰Ð°Ð¹Ñ‚Ðµ Ð¼Ð¾Ð´ÐµÐ»ÑŒ Ð¿Ð°Ð»ÑŒÑ†ÐµÐ¼."}),t.jsxs("div",{className:"px-4 mt-4",children:[t.jsxs("h2",{className:"text-sm font-semibold mb-2",children:["Ð—Ð¾Ð½Ñ‹ Ð±Ð¾Ð»Ð¸ ",s.length>0&&`(${s.length})`]}),t.jsx(z,{zones:s,onRemove:Z,onSelect:r,selectedZoneId:n??void 0})]}),v&&n&&t.jsx(L,{zone:v,painType:b?.painType,duration:b?.duration??"today",description:b?.description??"",onSave:S,onDelete:N,onClose:()=>r(null)}),t.jsx("div",{className:"fixed bottom-0 left-0 right-0 backdrop-blur border-t p-4",style:{backgroundColor:"rgba(var(--plm-bg-rgb, 0, 0, 0), 0.95)",borderColor:"var(--plm-border)",paddingBottom:Math.max(16,g.bottom)},children:t.jsx("div",{className:"flex gap-3 max-w-lg mx-auto",children:t.jsx("button",{type:"button",className:"flex-1 py-2.5 rounded-lg text-sm font-medium transition-colors",style:s.length>0?{backgroundColor:"var(--plm-btn-bg)",color:"var(--plm-text)"}:{backgroundColor:"var(--plm-bg-secondary)",color:"var(--plm-text-hint)",cursor:"not-allowed"},disabled:s.length===0,onClick:M,children:"Ð”Ð°Ð»ÐµÐµ â†’"})})})]})}export{U as default};
