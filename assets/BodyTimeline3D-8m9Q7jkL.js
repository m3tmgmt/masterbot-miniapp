import{r as d,j as e,g as p,d as g}from"./index-WG-X-atP.js";import{C as j,P as f,a as b,O as v}from"./body-zones-3d-DWMaaEv7.js";function y(t,r,n){const o=new Map,i=new Set([...t.keys(),...r.keys()]);for(const a of i){const c=t.get(a)??0,m=r.get(a)??0;o.set(a,c+(m-c)*n)}return o}function C({zone:t,intensity:r}){if(r<.5)return null;const n=g(Math.round(r)),o=p(Math.round(r));return e.jsxs("mesh",{position:t.position,children:[e.jsx("sphereGeometry",{args:[t.radius,16,16]}),e.jsx("meshBasicMaterial",{color:n,transparent:!0,opacity:o,depthWrite:!1})]})}function M({currentZones:t}){const r=d.useRef(null);return e.jsxs(e.Fragment,{children:[e.jsx("ambientLight",{intensity:.6}),e.jsx("directionalLight",{position:[2,3,2],intensity:.8}),e.jsx("directionalLight",{position:[-1,2,-2],intensity:.3}),e.jsxs("group",{children:[e.jsx(f,{}),b.map(n=>e.jsx(C,{zone:n,intensity:t.get(n.zoneId)??0},n.zoneId))]}),e.jsx(v,{ref:r,enablePan:!1,minDistance:2,maxDistance:5,minPolarAngle:Math.PI*.15,maxPolarAngle:Math.PI*.85,target:[0,.3,0],enableDamping:!0,dampingFactor:.1})]})}function I({snapshots:t}){const r=Math.max(0,t.length-1),[n,o]=d.useState(r),i=d.useMemo(()=>{if(t.length===0)return new Map;if(t.length===1)return t[0].zones;const l=Math.min(n,r),s=Math.floor(l),x=Math.min(s+1,r),h=l-s;return y(t[s].zones,t[x].zones,h)},[t,n,r]),a=Math.round(Math.min(n,r)),c=t[a],m=d.useMemo(()=>{let l=0;for(const[,s]of i)s>=.5&&l++;return l},[i]),u=d.useCallback(l=>{o(parseFloat(l.target.value))},[]);return t.length===0?e.jsx("div",{className:"flex items-center justify-center rounded-xl border p-8",style:{borderColor:"var(--plm-border)",backgroundColor:"var(--plm-bg-secondary)"},children:e.jsx("p",{className:"text-sm",style:{color:"var(--plm-text-hint)"},children:"Нет данных для отображения истории"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--plm-text)"},children:c?.label??"Сеанс"}),e.jsxs("span",{className:"text-xs",style:{color:"var(--plm-text-hint)"},children:[c?.date??""," • ",m," зон"]})]}),e.jsx("div",{className:"rounded-xl overflow-hidden border",style:{height:"45vh",borderColor:"var(--plm-border)",backgroundColor:"var(--plm-bg)"},children:e.jsx(j,{camera:{position:[0,.5,3.5],fov:40},dpr:[1,1.5],gl:{antialias:!0,powerPreference:"low-power"},style:{width:"100%",height:"100%",touchAction:"none"},children:e.jsx(M,{currentZones:i})})}),t.length>1&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"relative h-4 mx-1",children:t.map((l,s)=>e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -translate-x-1/2",style:{left:`${s/r*100}%`},children:e.jsx("div",{className:"w-2.5 h-2.5 rounded-full border-2 transition-colors",style:{backgroundColor:s===a?"var(--plm-btn-bg)":"var(--plm-bg-secondary)",borderColor:s===a?"var(--plm-btn-bg)":"var(--plm-border)"}})},l.sessionId))}),e.jsx("input",{type:"range",min:"0",max:r,step:"0.01",value:n,onChange:u,className:"w-full",style:{accentColor:"var(--plm-btn-bg)"}}),e.jsxs("div",{className:"flex justify-between text-xs mt-1",style:{color:"var(--plm-text-hint)"},children:[e.jsx("span",{children:t[0].date}),e.jsx("span",{children:t[t.length-1].date})]})]})]})}export{I as BodyTimeline3D};
